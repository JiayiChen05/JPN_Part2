<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Events - Public Affirmation Library</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/theme-toggle.css" />
    <link rel="stylesheet" href="../css/events.css" />
  </head>
  <body>
    <header>
      <nav class="navbar">
        <div class="logo">
          <h1>Public Affirmation Library</h1>
        </div>
        <div class="nav-buttons">
          <button
            class="theme-toggle"
            onclick="toggleTheme()"
            aria-label="Toggle theme"
          >
            <svg
              class="sun-icon"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
            >
              <path
                d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM12 21.75a.75.75 0 01-.75-.75v-2.25a.75.75 0 011.5 0V21a.75.75 0 01-.75.75zM3 12a.75.75 0 01.75-.75h2.25a.75.75 0 010 1.5H3.75A.75.75 0 013 12zM21 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5h2.25A.75.75 0 0121 12zM5.78 5.78a.75.75 0 011.06 0l1.5 1.5a.75.75 0 01-1.06 1.06l-1.5-1.5a.75.75 0 010-1.06zM18.22 18.22a.75.75 0 01-1.06 0l-1.5-1.5a.75.75 0 011.06-1.06l1.5 1.5a.75.75 0 010 1.06zM18.22 5.78a.75.75 0 010 1.06l-1.5 1.5a.75.75 0 11-1.06-1.06l1.5-1.5a.75.75 0 011.06 0zM5.78 18.22a.75.75 0 010-1.06l1.5-1.5a.75.75 0 111.06 1.06l-1.5 1.5a.75.75 0 01-1.06 0z"
              />
            </svg>
            <svg
              class="moon-icon"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
            >
              <path
                fill-rule="evenodd"
                d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z"
                clip-rule="evenodd"
              />
            </svg>
          </button>
          <button onclick="location.href='../index.html'" class="btn">
            Home
          </button>
          <button onclick="location.href='login.html'" class="btn">
            Login
          </button>
        </div>
      </nav>
    </header>

    <main>
      <div class="hero-section">
        <h2>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"
            />
          </svg>
          Upcoming Events
        </h2>
        <p>Join our vibrant community events and expand your horizons</p>
      </div>

      <div class="filter-buttons">
        <button class="btn" onclick="renderEvents('all')">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z"
            />
          </svg>
          All Events
        </button>
        <button class="btn" onclick="renderEvents('Seminar')">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M4.26 10.147a60.436 60.436 0 00-.491 6.347A48.627 48.627 0 0112 20.904a48.627 48.627 0 018.232-4.41 60.46 60.46 0 00-.491-6.347m-15.482 0a50.57 50.57 0 00-2.658-.813A59.905 59.905 0 0112 3.493a59.902 59.902 0 0110.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.697 50.697 0 0112 13.489a50.702 50.702 0 017.74-3.342M6.75 15a.75.75 0 100-1.5.75.75 0 000 1.5zm0 0v-3.675A55.378 55.378 0 0112 8.443m-7.007 11.55A5.981 5.981 0 006.75 15.75v-1.5"
            />
          </svg>
          Seminars
        </button>
        <button class="btn" onclick="renderEvents('Exhibition')">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"
            />
          </svg>
          Exhibitions
        </button>
      </div>

      <div id="eventCards" class="events-grid"></div>
    </main>

    <footer>
      <p>&copy; 2024 Public Affirmation Library. All rights reserved.</p>
    </footer>

    <script>
      let seminars = [];
      let exhibitions = [];

      document.addEventListener("DOMContentLoaded", () => {
        fetchSeminars();
        fetchExhibitions();
        initializeTheme();
      });

      async function fetchSeminars() {
        try {
          const res = await fetch("../api/get_seminars.php");
          const json = await res.json();
          console.log("Seminars API response:", json);
          if (json.status === "success") {
            seminars = json.data || [];
          } else {
            console.error("Seminar API error:", json.message || "Unknown error");
          }
          renderEvents("all");
        } catch (e) {
          console.error("Seminar fetch error:", e);
        }
      }

      async function fetchExhibitions() {
        try {
          const res = await fetch("../api/get_exhibitions.php");
          const json = await res.json();
          console.log("Exhibitions API response:", json);
          if (json.status === "success") {
            exhibitions = json.data || [];
          } else {
            console.error("Exhibition API error:", json.message || "Unknown error");
          }
          renderEvents("all");
        } catch (e) {
          console.error("Exhibition fetch error:", e);
        }
      }

      function renderEvents(filter) {
        const container = document.getElementById("eventCards");
        container.innerHTML = "";
        
        if (seminars.length === 0 && exhibitions.length === 0) {
          container.innerHTML = `
            <div class="no-events-message">
              <p>No events found. Please check back later.</p>
            </div>
          `;
          return;
        }
        
        const all = [
          ...seminars.map((e, i) => ({
            type: "Seminar",
            id: e.E_ID,
            name: e.E_NAME,
            topic: e.topic_name,
            start: e.E_STARTTIME,
            end: e.E_ENDTIME,
            extra: `Speaker: ${e.SPEAKER_FNAME} ${e.SPEAKER_LNAME}`,
            placeholderText: e.E_NAME || "Seminar Event",
          })),
          ...exhibitions.map((e, i) => ({
            type: "Exhibition",
            id: e.ex_ID || e.E_ID,
            name: e.E_NAME,
            topic: e.topic_name,
            start: e.E_STARTTIME,
            end: e.E_ENDTIME,
            extra: `Funding: $${parseFloat(e.EXPENSE || 0).toFixed(2)}`,
            placeholderText: e.E_NAME || "Exhibition Event",
          })),
        ];

        const eventsToShow =
          filter === "all" ? all : all.filter((e) => e.type === filter);
          
        if (eventsToShow.length === 0) {
          container.innerHTML = `
            <div class="no-events-message">
              <p>No ${filter} events found.</p>
            </div>
          `;
          return;
        }
        
        eventsToShow.forEach((event) => {
          const card = document.createElement("div");
          card.className = "event-card";
          card.innerHTML = `
          <div class="event-image">
            <span class="event-type">${event.type}</span>
          </div>
          <div class="event-content">
            <h3>${event.name}</h3>
            <div class="event-details">
              <div class="detail">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z" />
                </svg>
                <span>${event.topic || 'General'}</span>
              </div>
              <div class="detail">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span>${event.start || 'TBD'} - ${event.end || 'TBD'}</span>
              </div>
              <div class="detail">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                </svg>
                <span>${event.extra || 'Details forthcoming'}</span>
              </div>
            </div>
            <button onclick="location.href='event_register.html?event_id=${
              event.id
            }&type=${event.type}&title=${encodeURIComponent(event.name)}'" class="btn">
              Register Now
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
              </svg>
            </button>
          </div>
        `;
          container.appendChild(card);
        });
      }
    </script>
    <script src="../js/theme-toggle.js"></script>
  </body>
</html>
