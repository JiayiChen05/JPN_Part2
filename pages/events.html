<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Events - Public Affirmation Library</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/theme-toggle.css" />
    <link rel="stylesheet" href="../css/events.css" />
  </head>
  <body>
    <header>
      <nav class="navbar">
        <div class="logo">
          <h1>Public Affirmation Library</h1>
        </div>
        <div class="nav-buttons">
          <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme"></button>
          <button onclick="location.href='../index.html'" class="btn">Home</button>
          <button onclick="location.href='login.html'" class="btn">Login</button>
        </div>
      </nav>
    </header>

    <main>
      <div class="hero-section">
        <h2>Upcoming Events</h2>
        <p>Join our vibrant community events and expand your horizons</p>
      </div>

      <div class="filter-buttons">
        <button class="btn" onclick="renderEvents('all')">All Events</button>
        <button class="btn" onclick="renderEvents('Seminar')">Seminars</button>
        <button class="btn" onclick="renderEvents('Exhibition')">Exhibitions</button>
      </div>

      <div id="eventCards" class="events-grid"></div>
    </main>

    <footer>
      <p>&copy; 2024 Public Affirmation Library. All rights reserved.</p>
    </footer>

    <script>
      let seminars = [];
      let exhibitions = [];

      document.addEventListener("DOMContentLoaded", () => {
        fetchSeminars();
        fetchExhibitions();
        initializeTheme();
      });

      async function fetchSeminars() {
        try {
          const res = await fetch("../api/get_seminars.php");
          const json = await res.json();
          if (json.status === "success") {
            seminars = json.data || [];
          }
          renderEvents("all");
        } catch (e) {
          console.error("Seminar fetch error:", e);
        }
      }

      async function fetchExhibitions() {
        try {
          const res = await fetch("../api/get_exhibitions.php");
          const json = await res.json();
          if (json.status === "success") {
            exhibitions = json.data || [];
          }
          renderEvents("all");
        } catch (e) {
          console.error("Exhibition fetch error:", e);
        }
      }

      function renderEvents(filter) {
        const container = document.getElementById("eventCards");
        container.innerHTML = "";
        
        if (seminars.length === 0 && exhibitions.length === 0) {
          container.innerHTML = `<div class="no-events-message"><p>No events found. Please check back later.</p></div>`;
          return;
        }

        const all = [
          ...seminars.map((e) => ({
            type: "Seminar",
            id: e.E_ID,
            name: e.E_NAME,
            topic: e.topic_name,
            start: e.E_STARTTIME,
            end: e.E_ENDTIME,
            extra: `Speaker: ${e.SPEAKER_FNAME} ${e.SPEAKER_LNAME}`,
          })),
          ...exhibitions.map((e) => ({
            type: "Exhibition",
            id: e.ex_ID || e.E_ID,
            name: e.E_NAME,
            topic: e.topic_name,
            start: e.E_STARTTIME,
            end: e.E_ENDTIME,
            extra: `Funding: $${parseFloat(e.EXPENSE || 0).toFixed(2)}`,
          })),
        ];

        const eventsToShow = filter === "all" ? all : all.filter((e) => e.type === filter);
        
        if (eventsToShow.length === 0) {
          container.innerHTML = `<div class="no-events-message"><p>No ${filter} events found.</p></div>`;
          return;
        }

        eventsToShow.forEach((event) => {
          const card = document.createElement("div");
          card.className = "event-card";
          card.innerHTML = `
            <div class="event-image">
              <span class="event-type">${event.type}</span>
            </div>
            <div class="event-content">
              <h3>${event.name}</h3>
              <div class="event-details">
                <div class="detail">
                  <span>${event.topic || 'General'}</span>
                </div>
                <div class="detail">
                  <span>${event.start || 'TBD'} - ${event.end || 'TBD'}</span>
                </div>
                <div class="detail">
                  <span>${event.extra || 'Details forthcoming'}</span>
                </div>
              </div>
              <button onclick="location.href='event_register.html?event_id=${event.id}&type=${event.type}&title=${encodeURIComponent(event.name)}'" class="btn">
                Register Now
              </button>
            </div>
          `;
          container.appendChild(card);
        });
      }
    </script>
    <script src="../js/theme-toggle.js"></script>
  </body>
</html>
