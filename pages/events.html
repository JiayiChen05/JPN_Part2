<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Events - Public Affirmation Library</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f8f9fa;
    }
    .navbar {
      background-color: #2c3e50;
    }
    .navbar h1 {
      color: white;
      margin: 0;
    }
    .nav-buttons .btn {
      margin-left: 10px;
    }
    footer {
      background-color: #2c3e50;
      color: white;
      text-align: center;
      padding: 1rem;
      margin-top: 2rem;
    }
    .filter-buttons {
      text-align: center;
      margin-bottom: 2rem;
    }
    .filter-buttons .btn {
      margin: 0 0.5rem;
    }
    .card-img-top {
    height: 180px;
    object-fit: cover;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg px-4 py-3">
    <div class="container-fluid">
      <h1>Public Affirmation Library</h1>
      <div class="nav-buttons ms-auto">
        <a href="../index.html" class="btn btn-primary">Home</a>
        <a href="login.html" class="btn btn-secondary">Login</a>
      </div>
    </div>
  </nav>

  <main class="container py-5">
    <h2 class="text-center mb-4">Upcoming Events</h2>

    <div class="filter-buttons">
      <button class="btn btn-outline-primary" onclick="renderEvents('all')">All</button>
      <button class="btn btn-outline-success" onclick="renderEvents('Seminar')">Seminar</button>
      <button class="btn btn-outline-info" onclick="renderEvents('Exhibition')">Exhibition</button>
    </div>

    <div id="eventCards" class="row row-cols-1 row-cols-md-3 g-4"></div>
  </main>

  <footer>
    <p>&copy; 2024 Public Affirmation Library. All rights reserved.</p>
  </footer>

  <script>
    let seminars = [];
    let exhibitions = [];

    document.addEventListener('DOMContentLoaded', () => {
      fetchSeminars();
      fetchExhibitions();
    });

    async function fetchSeminars() {
      try {
        const res = await fetch('/library_management/api/get_seminars.php');
        const json = await res.json();
        if (json.status === 'success') seminars = json.data;
        renderEvents('all');
      } catch (e) {
        console.error('Seminar error:', e);
      }
    }

    async function fetchExhibitions() {
      try {
        const res = await fetch('/library_management/api/get_exhibitions.php');
        const json = await res.json();
        if (json.status === 'success') exhibitions = json.data;
        renderEvents('all');
      } catch (e) {
        console.error('Exhibition error:', e);
      }
    }

    function renderEvents(filter) {
      const container = document.getElementById('eventCards');
      container.innerHTML = '';
      const all = [
        ...seminars.map((e, i) => ({
          type: 'Seminar',
          id: e.E_ID,
          name: e.E_NAME,
          topic: e.topic_name,
          start: e.E_STARTTIME,
          end: e.E_ENDTIME,
          extra: `Speaker: ${e.SPEAKER_FNAME} ${e.SPEAKER_LNAME}`,
          img: `../images/event${(i % 5) + 1}.jpg`
        })),
        ...exhibitions.map((e, i) => ({
          type: 'Exhibition',
          id: e.ex_ID,
          name: e.E_NAME,
          topic: e.topic_name,
          start: e.E_STARTTIME,
          end: e.E_ENDTIME,
          extra: `Funding: $${parseFloat(e.EXPENSE).toFixed(2)}`,
          img: `../images/event${((i + 5) % 5) + 1}.jpg`
        }))
      ];

      const eventsToShow = filter === 'all' ? all : all.filter(e => e.type === filter);
      eventsToShow.forEach(event => {
        const card = document.createElement('div');
        card.className = 'col';
        card.innerHTML = `
          <div class="card h-100 shadow-sm">
            <img src="${event.img}" class="card-img-top" alt="Event Image">
            <div class="card-body">
              <h5 class="card-title">${event.name}</h5>
              <p class="card-text"><strong>Type:</strong> ${event.type}</p>
              <p class="card-text"><strong>Topic:</strong> ${event.topic}</p>
              <p class="card-text"><strong>Start:</strong> ${event.start}</p>
              <p class="card-text"><strong>End:</strong> ${event.end}</p>
              <p class="card-text">${event.extra}</p>
              <a href="event_register.html?event_id=${event.id}&img=${encodeURIComponent(event.img)}" class="btn btn-primary mt-2">Register</a>
            </div>
          </div>
        `;
        container.appendChild(card);
      });
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>