<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customer Dashboard - Public Affirmation Library</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/customer_dashboard.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    #content-area {
      padding: 20px;
      min-height: 500px;
    }

    .nav-link.active {
      font-weight: bold;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>
    <nav class="navbar">
      <div class="logo">
        <h1>Public Affirmation Library</h1>
      </div>
      <div class="nav-menu">
        <a href="#" class="nav-link active" onclick="loadPage('home.html', this)">Home</a>
        <a href="#" class="nav-link" onclick="loadPage('books.html', this)">Books</a>
        <a href="#" class="nav-link" onclick="loadPage('events.html', this)">Events</a>
        <a href="#" class="nav-link" onclick="loadPage('study_room.html', this)">Study Rooms</a>
        <a href="#" class="nav-link" onclick="loadPage('contact.html', this)">Contact</a>
      </div>
      <div class="dropdown">
        <button class="btn dropdown-toggle" id="user-button">👤</button>
        <div class="dropdown-content">
          <a href="#" onclick="loadPage('profile.html')">👤 Profile Settings</a>
          <a href="#" onclick="loadPage('change_password.html')">🔒 Update Password</a>
          <a href="#" onclick="loadPage('my_rentals.html')">📄 My Rentals</a>
          <a href="#" onclick="loadPage('my_bookings.html')">📝 My Bookings</a>
          <hr>
          <a href="#" class="sign-out" onclick="logout()">🚪 Sign Out</a>
        </div>
      </div>
    </nav>
  </header>

  <main>
    <div id="content-area">
      <h2>Welcome to Public Affirmation Library</h2>
      <p>Explore and interact with our library services</p>
    </div>
  </main>

  <footer>
    <p>&copy; 2024 Public Affirmation Library. All rights reserved.</p>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const fname = localStorage.getItem('customer_fname') || '';
      const lname = localStorage.getItem('customer_lname') || '';
      const name = (fname + ' ' + lname).trim() || 'Customer';
      const userBtn = document.getElementById('user-button');
      if (userBtn) {
        userBtn.textContent = `👤 ${name} ▼`;
      }

      const isAuthor = localStorage.getItem('is_author') === 'true';
      const isSponsor = localStorage.getItem('is_sponsor') === 'true';

      if (isAuthor) {
        const seminarsLink = document.createElement('a');
        seminarsLink.href = '#';
        seminarsLink.className = 'nav-link';
        seminarsLink.textContent = 'Seminars';
        seminarsLink.onclick = () => loadPage('seminars.html', seminarsLink);
        document.querySelector('.nav-menu').appendChild(seminarsLink);
      }

      if (isSponsor) {
        const sponsorLink = document.createElement('a');
        sponsorLink.href = '#';
        sponsorLink.className = 'nav-link';
        sponsorLink.textContent = 'Sponsor Seminar';
        sponsorLink.onclick = () => loadPage('sponsor_seminar.html', sponsorLink);
        document.querySelector('.nav-menu').appendChild(sponsorLink);
      }
    });

    function logout() {
      ['customer_id', 'customer_fname', 'customer_lname', 'user_role', 'is_author', 'is_sponsor'].forEach(key => {
        localStorage.removeItem(key);
      });
      window.location.href = 'login.html';
    }

    function loadPage(url, link = null) {
      fetch(url)
        .then(response => {
          if (!response.ok) throw new Error(`Failed to load ${url}`);
          return response.text();
        })
        .then(html => {
          document.getElementById('content-area').innerHTML = html;

          if (link) {
            document.querySelectorAll('.nav-link').forEach(a => a.classList.remove('active'));
            link.classList.add('active');
          }

          // Page-specific initialization logic
          if (url.includes('events.html') && typeof initEventsPage === 'function') initEventsPage();
          if (url.includes('books.html') && typeof initBooksPage === 'function') initBooksPage();
          if (url.includes('profile.html') && typeof initProfilePage === 'function') initProfilePage();
          if (url.includes('my_rentals.html') && typeof initRentalsPage === 'function') initRentalsPage();
          if (url.includes('my_bookings.html') && typeof initBookingsPage === 'function') initBookingsPage();
        })
        .catch(error => {
          console.error('Error loading page:', error);
          document.getElementById('content-area').innerHTML = `<p class="error">Failed to load content. Please try again later.</p>`;
        });
    }
  </script>
</body>
</html>